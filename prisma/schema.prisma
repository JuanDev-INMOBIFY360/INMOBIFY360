generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "debian-openssl-3.0.x", "debian-openssl-1.1.x", "windows"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

enum PrivilegeAction {
    CREATE
    READ
    UPDATE
    DELETE
    CHANGE_STATE
}

enum PropertyState {
    AVAILABLE
    SOLD
    RENTED
}

model Country {
    id          Int          @id @default(autoincrement())
    name        String       @unique
    departments Department[]
    properties  Property[]
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
}

model Department {
    id         Int        @id @default(autoincrement())
    name       String
    country    Country    @relation(fields: [countryId], references: [id])
    countryId  Int
    cities     City[]
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt

    @@unique([name, countryId])
}

model City {
    id            Int            @id @default(autoincrement())
    name          String
    
    department    Department     @relation(fields: [departmentId], references: [id])
    departmentId  Int
    neighborhoods Neighborhood[]
    properties    Property[]
    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt

    @@unique([name, departmentId])
}

model Neighborhood {
    id         Int        @id @default(autoincrement())
    name       String
    city       City       @relation(fields: [cityId], references: [id])
    cityId     Int
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt

    @@unique([name, cityId])
}

model Roles {
  id              Int              @id @default(autoincrement())
  name            String           @unique
  description     String?
  users           User[]
  rolePermissions RolePermission[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model User {
    id        Int      @id @default(autoincrement())
    email     String   @unique
    password  String
    name      String
    role      Roles?   @relation(fields: [roleId], references: [id])
    roleId    Int?
    status    Boolean  @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Permissions {
  id              Int              @id @default(autoincrement())
  name            String           @unique
  displayName     String
  description     String?
  rolePermissions RolePermission[]
  privileges      Privileges[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model RolePermission {
  id           Int         @id @default(autoincrement())
  roleId       Int
  permissionId Int
  role         Roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  privileges   RolePermissionPrivilege[]
  createdAt    DateTime    @default(now())

  @@unique([roleId, permissionId])
}

model Privileges {
  id                       Int                       @id @default(autoincrement())
  action                   PrivilegeAction
  displayName              String
  description              String?
  permissionId             Int
  permission               Permissions               @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  rolePermissionPrivileges RolePermissionPrivilege[]
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt

  @@unique([action, permissionId])
}

model RolePermissionPrivilege {
  id               Int            @id @default(autoincrement())
  rolePermissionId Int
  privilegeId      Int
  rolePermission   RolePermission @relation(fields: [rolePermissionId], references: [id], onDelete: Cascade)
  privilege        Privileges     @relation(fields: [privilegeId], references: [id], onDelete: Cascade)

  @@unique([rolePermissionId, privilegeId])
}


model TypeProperty {
    id         Int        @id @default(autoincrement())
    name       String     @unique
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
}

model Property {
    id             Int           @id @default(autoincrement())
    titulo         String?       // "Apartamento moderno en El Poblado"
    descripcion    String?       @db.Text // Descripción larga
    precio         Float
    area           Float?
    areaPrivada    Float?        // Área privada (diferente del área total)
    habitaciones   Int?
    banos          Int?
    parqueaderos   Int?
    estrato        Int?          // Estrato socioeconómico (1-6 en Colombia)
    piso           Int?          // Número de piso
    antiguedad     Int?          // Años de antigüedad
    administracion Float?        // Costo de administración mensual
    amenidades     Json?         
    direccion      String
    latitud        Float?
    longitud       Float?
    imagenes       Json?         // [{url: "", descripcion: ""}]
    videoUrl       String?       // URL del video tour
    tourVirtual    String?       // URL del tour 360°    
    estado         PropertyState @default(AVAILABLE)
    destacada      Boolean       @default(false) // Para propiedades destacadas
    owner          Owner         @relation(fields: [ownerId], references: [id])
    ownerId        Int
    country        Country       @relation(fields: [countryId], references: [id])
    countryId      Int
    department     Department    @relation(fields: [departmentId], references: [id])
    departmentId   Int
    city           City          @relation(fields: [cityId], references: [id])
    cityId         Int
    neighborhood   Neighborhood  @relation(fields: [neighborhoodId], references: [id])
    neighborhoodId Int
    typeProperty   TypeProperty  @relation(fields: [typePropertyId], references: [id])
    typePropertyId Int
    
    // Timestamps
    createdAt      DateTime      @default(now())
    updatedAt      DateTime      @updatedAt
}

model Owner {
    id         Int        @id @default(autoincrement())
    name       String
    email      String     @unique
    phone      String?
    document   String?    @unique
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
}
