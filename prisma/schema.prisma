generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "debian-openssl-3.0.x", "debian-openssl-1.1.x", "windows"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

/* =======================
   ENUMS
======================= */

enum PrivilegeAction {
    CREATE
    READ
    UPDATE
    DELETE
    CHANGE_STATE
}

enum PropertyState {
    AVAILABLE
    SOLD
    RENTED
    INACTIVE
}
enum OperationType {
    SALE
    RENT
}

/* =======================
   LOCATION
======================= */

model Country {
    id          Int          @id @default(autoincrement())
    name        String       @unique
    departments Department[]
    properties  Property[]
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
}

model Department {
    id         Int        @id @default(autoincrement())
    name       String
    country    Country    @relation(fields: [countryId], references: [id])
    countryId  Int
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt

    @@unique([name, countryId])
}

/* =======================
   AUTH & PERMISSIONS
======================= */

model Roles {
    id              Int              @id @default(autoincrement())
    name            String           @unique
    description     String?
    users           User[]
    rolePermissions RolePermission[]
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
}

model User {
    id        Int      @id @default(autoincrement())
    email     String   @unique
    password  String
    name      String
    role      Roles?   @relation(fields: [roleId], references: [id])
    roleId    Int?
    status    Boolean  @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Permissions {
    id              Int              @id @default(autoincrement())
    name            String           @unique
    displayName     String
    description     String?
    rolePermissions RolePermission[]
    privileges      Privileges[]
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
}

model RolePermission {
    id           Int         @id @default(autoincrement())
    roleId       Int
    permissionId Int
    role         Roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)
    permission   Permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
    privileges   RolePermissionPrivilege[]
    createdAt    DateTime    @default(now())

    @@unique([roleId, permissionId])
}

model Privileges {
    id                       Int                       @id @default(autoincrement())
    action                   PrivilegeAction
    displayName              String
    description              String?
    permissionId             Int
    permission               Permissions               @relation(fields: [permissionId], references: [id], onDelete: Cascade)
    rolePermissionPrivileges RolePermissionPrivilege[]
    createdAt                DateTime                  @default(now())
    updatedAt                DateTime                  @updatedAt

    @@unique([action, permissionId])
}

model RolePermissionPrivilege {
    id               Int            @id @default(autoincrement())
    rolePermissionId Int
    privilegeId      Int
    rolePermission   RolePermission @relation(fields: [rolePermissionId], references: [id], onDelete: Cascade)
    privilege        Privileges     @relation(fields: [privilegeId], references: [id], onDelete: Cascade)

    @@unique([rolePermissionId, privilegeId])
}

/* =======================
   REAL ESTATE
======================= */

model TypeProperty {
    id         Int        @id @default(autoincrement())
    name       String     @unique
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
}

model Property {
    id             Int           @id @default(autoincrement())

    // Identificaci√≥n
    codigo         String        @unique
    titulo         String?
    descripcion    String?       @db.Text

    // Operaci√≥n
    operacion      OperationType @default(SALE)

    // Precio
    precio         Float
    moneda         String        @default("COP")

    // Caracter√≠sticas
    habitaciones   Int?
    banos          Int?
    parqueaderos   Int?

    // √Åreas
    areaConstruida Float?
    areaPrivada    Float?

    // Estado f√≠sico / comercial
    estadoFisico   String?       // "Nuevo", "Bueno", "Remodelado"

    // Amenidades / zonas comunes
    amenidades     Json?

    // üìç Ubicaci√≥n
    ciudad         String
    barrio         String?
    direccion      String
    latitud        Float?
    longitud       Float?

    // üñºÔ∏è Im√°genes
    imagenes       Json?

    // Estado y visibilidad
    estado           PropertyState @default(AVAILABLE)
    publicada        Boolean       @default(false)
    fechaPublicacion DateTime?
    destacada        Boolean       @default(false)

    // Relaciones
    country        Country       @relation(fields: [countryId], references: [id])
    countryId      Int

    department     Department    @relation(fields: [departmentId], references: [id])
    departmentId   Int

    owner          Owner         @relation(fields: [ownerId], references: [id])
    ownerId        Int

    typeProperty   TypeProperty  @relation(fields: [typePropertyId], references: [id])
    typePropertyId Int

    createdAt      DateTime      @default(now())
    updatedAt      DateTime      @updatedAt

    @@index([ciudad])
    @@index([precio])
    @@index([habitaciones])
    @@index([banos])
    @@index([publicada])
}


model Owner {
    id         Int        @id @default(autoincrement())
    name       String
    email      String     @unique
    phone      String?
    document   String?    @unique
    properties Property[]
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
}
